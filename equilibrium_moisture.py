from utils import round_to_nearest

equilibrium_moisture_content = [
    [3, 5, 7, 8, 10, 11, 12, 13, 13, 14, 15, 16, 17, 18, 19, 21, 22, 23, 25, 28, 34],
    [3, 5, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 22, 23, 25, 28, 34],
    [3, 5, 6, 8, 9, 10, 11, 12, 13, 14, 15, 15, 16, 17, 19, 20, 21, 23, 25, 28, 34],
    [3, 4, 6, 7, 8, 10, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 21, 22, 24, 27, 33],
    [3, 4, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 22, 24, 27, 33],
    [3, 4, 6, 7, 8, 9, 10, 11, 12, 13, 13, 14, 15, 16, 17, 19, 20, 22, 24, 27, 33],
    [2, 4, 5, 6, 8, 9, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 20, 21, 23, 26, 32],
    [2, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 21, 23, 26, 32],
    [2, 3, 5, 6, 7, 8, 9, 10, 11, 11, 12, 13, 14, 15, 16, 17, 19, 20, 22, 26, 32],
    [2, 3, 5, 6, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 20, 22, 25, 31],
    [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 12, 13, 14, 15, 17, 18, 19, 22, 25, 31],
    [2, 3, 4, 5, 6, 7, 8, 9, 9, 10, 11, 12, 13, 14, 15, 16, 17, 19, 21, 24, 31],
    [2, 3, 4, 5, 6, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 19, 21, 24, 30],
    [1, 2, 4, 5, 6, 6, 7, 8, 9, 10, 10, 11, 12, 13, 14, 15, 17, 18, 20, 23, 30],
    [1, 2, 4, 4, 5, 6, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 16, 18, 20, 23, 29],
    [1, 2, 3, 4, 5, 6, 7, 7, 8, 9, 10, 11, 11, 12, 13, 14, 16, 17, 19, 22, 29],
    [1, 2, 3, 4, 5, 6, 6, 7, 8, 9, 9, 10, 11, 12, 13, 14, 15, 17, 19, 22, 28],
    [1, 2, 3, 4, 5, 5, 6, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 16, 18, 21, 28],
    [1, 2, 3, 4, 4, 5, 6, 7, 7, 8, 9, 9, 10, 11, 12, 13, 14, 16, 18, 21, 27],
    [1, 2, 3, 3, 4, 5, 6, 6, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 17, 20, 26],
    [1, 2, 2, 3, 4, 5, 5, 6, 7, 7, 8, 9, 9, 10, 11, 12, 13, 15, 17, 20, 26],
    [1, 1, 2, 3, 4, 4, 5, 6, 6, 7, 8, 8, 9, 10, 11, 12, 13, 14, 16, 19, 25],
    [1, 1, 2, 3, 4, 4, 5, 5, 6, 7, 7, 8, 9, 10, 10, 11, 13, 14, 16, 19, 25],
    [1, 1, 2, 3, 3, 4, 5, 5, 6, 6, 7, 8, 8, 9, 10, 11, 12, 13, 15, 18, 24],
]

fuel_temp_thresholds = [
    10,
    15,
    20,
    25,
    30,
    35,
    40,
    45,
    50,
    55,
    60,
    65,
    70,
    75,
    80,
    85,
    90,
    95,
    100,
    105,
    110,
    115,
    120,
    125,
]
rel_hum_thresholds = [
    0,
    5,
    10,
    15,
    20,
    25,
    30,
    35,
    40,
    45,
    50,
    55,
    60,
    65,
    70,
    75,
    80,
    85,
    90,
    95,
    100,
]


# Helper functions
def round_to_nearest(value, base):
    return base * round(value / base)


def fuel_temp_ind(fuel_temp):
    if fuel_temp < 10:
        return 0
    elif fuel_temp > 125:
        return 23
    else:
        rounded_temp = round_to_nearest(fuel_temp, 5)
        return fuel_temp_thresholds.index(rounded_temp)


def hum_ind(rel_hum):
    if rel_hum < 0:
        return 0
    elif rel_hum > 100:
        return 20
    else:
        rounded_hum = round_to_nearest(rel_hum, 5)
        return rel_hum_thresholds.index(rounded_hum)


# Main function
def get_eq_moist_content(fuel_temp, rel_hum):
    return equilibrium_moisture_content[fuel_temp_ind(fuel_temp)][hum_ind(rel_hum)]
